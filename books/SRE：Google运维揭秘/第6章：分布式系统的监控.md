[toc]

# 分布式系统的监控

## 术语定义

- **监控（monitoring）**：收集、处理、汇总，并且显示关于某个系统的实时量化数据，例如请求的数量和类型，错误的数量和类型
- **白盒监控（white-box monitoring）**：依靠系统内部暴露的一些性能指标进行监控。如日志分析
- **黑盒监控（black-box monitoring）**：通过测试某种外部用户可见的系统行为进行监控
- **监控台页面（dashboard）**：提供某个服务核心指标一览服务的应用程序（一般是基于Web的）。该应用程序可能会提供过滤功能（filter）、选择功能（selector）等
- **警报（alert）**：目标对象是某个人发向某个系统地址的一个通知。目的地可以包括工单系统、E-mail地址，或者某个传呼机。
- **根源问题（root cause）**：指系统（软件或流程）中的某种缺陷。这个缺陷如果被修复，就可以保证这种问题不会再以同样的方式发生。
- **节点或者机器（node/machine）**：这里的两个术语是可以互换的：指在物理机、虚拟机，或者容器内运行的某个实例
- **推送（push）**：关于某个服务正在运行的软件或者其配置文件的任何改动

## 为什么要监控

监控与报警可以让一个系统在发生故障时主动通知我们，或者能够告诉我们即将发生什么



- **分析长期趋势**：数据库目前的数据量，以及增长速度。又例如每日活跃用户的数量增长的速度。
- **跨时间范围的比较，或者是观察实验组与控制组之间的区别**：增加新节点后，memcache的缓存命中率是否增加？网站是否比上周速度要慢？
- **构建监控台页面**：
- **临时性的回溯分析（也就是在线调试）**：我们的请求延迟刚刚大幅增加了，有没有其他的现象同时发生？



紧急警报的处理会占用员工的宝贵时间。当紧急警报出现得太频繁时，员工会进入“狼来了”效应，怀疑警报的有效性甚至忽略该警报，有的时候在警告过多的时候甚至会忽略掉真实发生的故障。由于无效信息太多，分析和修复可能会变慢，故障时间也会相应延长。高效的警报系统应该提供足够的信息，并且误报率非常低。

## 对监控系统设置合理预期

监控一个复杂的应用程序本身就是一项复杂的工程项目。



监控系统中最重要的一点就是整个“生产故障，人工处理紧急警报，简单定位和深入调试”过程必须要保持非常简单，必须能被团队中任何一个人所理解。



监控系统信噪比应该很高，发出紧急警报的组件需要非常简单而且可靠。产生警报的监控系统规则应该非常容易理解，同时代表一个清晰的故障场景。

## 现象和原因

监控系统应该解决两个问题：什么东西出故障了，以及为什么出故障。



“什么东西出故障了”即为现象（symptom）:“为什么”则代表了原因



“现象”和“原因”的区分是构建信噪比高的监控系统时最重要的概念